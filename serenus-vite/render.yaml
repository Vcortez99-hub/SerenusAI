services:
  # Backend API
  - type: web
    name: essentia-api
    runtime: node
    region: oregon
    plan: free
    rootDir: server
    buildCommand: npm install
    startCommand: node index.js
    envVars:
      - key: PORT
        value: 3001
      - key: NODE_ENV
        value: production
      - key: FRONTEND_URL
        value: https://serenusai-1.onrender.com
      - key: WA_PHONE_NUMBER_ID
        sync: false
      - key: CLOUD_API_ACCESS_TOKEN
        sync: false
      - key: WEBHOOK_VERIFICATION_TOKEN
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
    autoDeploy: true

  # Frontend (SPA)
  - type: web
    name: essentia
    runtime: static
    region: oregon
    plan: free
    rootDir: serenus-vite
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    envVars:
      - key: VITE_API_URL
        value: https://essentia-api.onrender.com
    routes:
      - type: rewrite
        source: /api/*
        destination: https://essentia-api.onrender.com/api/:splat
      - type: rewrite
        source: /webhook/*
        destination: https://essentia-api.onrender.com/webhook/:splat
      - type: rewrite
        source: /stripe/*
        destination: https://essentia-api.onrender.com/stripe/:splat
      - type: rewrite
        source: /test-whatsapp
        destination: https://essentia-api.onrender.com/test-whatsapp
      - type: rewrite
        source: /health
        destination: https://essentia-api.onrender.com/health
      - type: rewrite
        source: /*
        destination: /index.html
    autoDeploy: true
